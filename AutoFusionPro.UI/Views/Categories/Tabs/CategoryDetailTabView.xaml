<UserControl x:Class="AutoFusionPro.UI.Views.Categories.Tabs.CategoryDetailTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:AutoFusionPro.UI.Views.Categories.Tabs"
             xmlns:vm="clr-namespace:AutoFusionPro.UI.ViewModels.Categories"
             xmlns:xBtn="clr-namespace:AutoFusionPro.UI.Controls.Buttons"
             xmlns:dtos="clr-namespace:AutoFusionPro.Application.DTOs.Category;assembly=AutoFusionPro.Application"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:spinner="clr-namespace:AutoFusionPro.UI.Controls.LoadingSpinners"
             xmlns:forms="clr-namespace:AutoFusionPro.UI.Controls.Forms"
             xmlns:wpfUi="http://schemas.lepo.co/wpfui/2022/xaml"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:CategoryDetailViewModel}"
             Background="{DynamicResource Window.BackgroundBrush}"
             Foreground="{DynamicResource Text.PrimaryBrush}"
             FontFamily="{DynamicResource DynamicFontFamilyRegular}"
             d:DesignHeight="1200" d:DesignWidth="1000">
    <UserControl.Resources>
        <Style x:Key="ModernCardStyle"
               TargetType="Border">
            <Setter Property="Background"
                    Value="{DynamicResource Card.Header.BackgroundBrush}" />
            <Setter Property="CornerRadius"
                    Value="8" />
            <Setter Property="Padding"
                    Value="20,24" />
            <Setter Property="BorderThickness"
                    Value="0,5,0,0" />
            <Setter Property="Margin"
                    Value="0,0,0,16" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10"
                                      ShadowDepth="1"
                                      Opacity="0.2" />
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Border>
        <ScrollViewer Padding="8,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Category Details Info -->
                <Grid Grid.Column="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Image with Rounded Corners -->
                    <Border CornerRadius="16,16,0,0"  VerticalAlignment="Top"
                            Height="300"
                            Width="300"
                            ClipToBounds="True"
                            Background="{DynamicResource Accent.Amethyst.BackgroundBrush}">

                        <!-- Image with Rounded Corners -->
                        <Grid>
                            <Grid.Clip>
                                <RectangleGeometry Rect="0,0,300,300"
                                                   RadiusX="16"
                                                   RadiusY="12" />
                            </Grid.Clip>

                            <!-- Background Image -->
                            <Image Source="{Binding CurrentCategory.ImagePath, Converter={StaticResource StringToImageSourceConverter}}"
                                   Stretch="Uniform"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center">
                                <Image.Clip>
                                    <RectangleGeometry Rect="0,0,300,300"
                                                       RadiusX="16"
                                                       RadiusY="12" />
                                </Image.Clip>
                                <!-- Fallback when no image -->
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CurrentCategory.ImagePath}"
                                                         Value="{x:Null}">
                                                <Setter Property="Visibility"
                                                        Value="Collapsed" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding CurrentCategory.ImagePath}"
                                                         Value="">
                                                <Setter Property="Visibility"
                                                        Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>

                            <!-- Fallback Icon for categories without images -->
                            <Grid Visibility="{Binding CurrentCategory.ImagePath, Converter={StaticResource NullOrEmptyToVisibilityConverter}}">
                                <Rectangle Fill="{DynamicResource Card.Header.BackgroundBrush}"
                                           Opacity="0.1"
                                           RadiusX="16"
                                           RadiusY="16" />
                                <StackPanel VerticalAlignment="Center">

                                    <wpfUi:SymbolIcon Symbol="AppFolder48"
                                                      FontSize="48"
                                                      Foreground="{DynamicResource Text.SecondaryBrush}"
                                                      Opacity="0.6"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />

                                    <TextBlock Text="{DynamicResource NoImageFoundStr}"
                                               HorizontalAlignment="Center" Opacity="0.7" FontFamily="{DynamicResource DynamicFontFamilyRegular}" />
                                </StackPanel>
                            </Grid>

                            <!-- Gradient Overlay with Rounded Corners -->
                            <Rectangle RadiusX="0"
                                       RadiusY="16">
                                <Rectangle.Fill>
                                    <LinearGradientBrush StartPoint="0,0.7"
                                                         EndPoint="0,1">
                                        <GradientStop Color="Transparent"
                                                      Offset="0" />
                                        <GradientStop Color="#66000000"
                                                      Offset="1" />
                                    </LinearGradientBrush>
                                </Rectangle.Fill>
                            </Rectangle>
                        </Grid>
                    </Border>

                    <!-- Name, Description, Status-->
                    <StackPanel Grid.Column="1"
                                Margin="32,0,0,0">

                        <!-- Controls -->
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right">
                            <xBtn:XButton Cursor="Hand"
                                          Style="{DynamicResource RegularButtonStyle}"
                                          ButtonType="Warning"
                                          Command="{Binding ShowEditCategoryDialogCommand}"
                                          CommandParameter="{Binding CurrentCategory}"
                                          IsLoading="{Binding IsEditingCategory}"
                                          Opacity="0.8"
                                          VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" 
                                            VerticalAlignment="Center">
                                    <TextBlock Text="{DynamicResource EditCategoryStr}"
                                               VerticalAlignment="Center" />
                                    <wpfUi:SymbolIcon Symbol="Edit48"
                                                      VerticalAlignment="Center" Margin="5,0,0,0"/>
                                </StackPanel>
                            </xBtn:XButton>

                            <xBtn:XButton Cursor="Hand"
                                          Style="{DynamicResource RegularButtonStyle}"
                                          Command="{Binding ShowDeleteCategoryDialogCommand}"
                                          CommandParameter="{Binding CurrentCategory}"
                                          ButtonType="Danger"
                                          VerticalAlignment="Center"
                                          IsLoading="{Binding IsDeletingCategory}"
                                          Opacity="0.8"
                                          Margin="5,0,0,0">
                                <StackPanel Orientation="Horizontal"
                                            VerticalAlignment="Center">
                                    <TextBlock Text="{DynamicResource DeleteCategoryStr}"
                                               VerticalAlignment="Center" />
                                    <wpfUi:SymbolIcon Symbol="Delete48" Margin="5,0,0,0"
                                                      VerticalAlignment="Center" />
                                </StackPanel>
                            </xBtn:XButton>
                        </StackPanel>
                        
                        
                        <!-- Name -->
                        <Border Padding="16"
                                Margin="0,14,0,0"
                                BorderThickness="4,0,0,0"
                                BorderBrush="{DynamicResource Toast.Primary.BackgroundBrush}"
                                CornerRadius="10,0,0,10"
                                Background="{DynamicResource Card.Header.BackgroundBrush}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <wpfUi:SymbolIcon Symbol="Tag32"
                                                      FontSize="{StaticResource FontSizeRegular}" />
                                    <TextBlock Text="{DynamicResource CategoryNameStr}"
                                               Margin="5,0,0,0"
                                               FontSize="{StaticResource FontSizeRegular}"
                                               Foreground="{DynamicResource Text.SecondaryBrush}" />

                                </StackPanel>
                                <TextBlock Text="{Binding CurrentCategory.Name, FallbackValue='Electronics'}"
                                           Margin="2,4,0,0"
                                           FontSize="{StaticResource FontSizeLarge}" Opacity="0.9" />
                            </StackPanel>
                        </Border>

                        <!-- Description -->
                        <Border Padding="16"
                                Margin="0,14,0,0"
                                VerticalAlignment="Bottom"
                                BorderThickness="4,0,0,0"
                                BorderBrush="{DynamicResource Toast.Primary.BackgroundBrush}"
                                CornerRadius="10,0,0,10"
                                Background="{DynamicResource Card.Header.BackgroundBrush}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <wpfUi:SymbolIcon Symbol="AlignLeft48"
                                                      FontSize="{StaticResource FontSizeRegular}" />
                                    <TextBlock Text="{DynamicResource DescriptionStr}"
                                               Margin="5,0,0,0"
                                               Foreground="{DynamicResource Text.SecondaryBrush}"
                                               FontSize="{StaticResource FontSizeRegular}" />

                                </StackPanel>
                                <TextBlock Text="{Binding CurrentCategory.Description, Converter={StaticResource UserFriendlyNoDescriptionConverter }, FallbackValue='Electronic components and parts for vehicles including batteries, alternators, starters, ignition systems, lighting systems, and various sensors used in modern automotive electrical systems.'}"
                                           Margin="2,8,0,0"
                                           Opacity="0.9"
                                           FontSize="{StaticResource FontSizeLarge}"
                                           TextWrapping="Wrap"
                                           TextTrimming="WordEllipsis" />
                            </StackPanel>
                        </Border>

                        <!-- Status  -->
                        <Border Padding="16"
                                Margin="0,14,0,0"
                                BorderThickness="4,0,0,0"
                                BorderBrush="{DynamicResource Toast.Primary.BackgroundBrush}"
                                CornerRadius="10,0,0,10"
                                Background="{DynamicResource Card.Header.BackgroundBrush}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <wpfUi:SymbolIcon Symbol="ToggleRight48"
                                                      FontSize="{StaticResource FontSizeRegular}" />
                                    <TextBlock Text="{DynamicResource StatusStr}"
                                               Margin="5,0,0,0"
                                               FontSize="{StaticResource FontSizeRegular}"
                                               Foreground="{DynamicResource Text.SecondaryBrush}" />

                                </StackPanel>
                                <Border Margin="2,8,0,0"
                                        Padding="10,3"
                                        Background="{DynamicResource Indicator.Green.BackgroundBrush}"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        ClipToBounds="True"
                                        CornerRadius="8"
                                        BorderBrush="{DynamicResource Border.PrimaryBrush}"
                                        BorderThickness="0.5">
                                    <TextBlock Text="{Binding CurrentCategory.IsActive, Converter={StaticResource BooleanToStatusTextConverter}}"
                                               Foreground="{DynamicResource Indicator.Green.ForegroundBrush}"
                                               FontSize="{StaticResource FontSizeRegular}" />
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                </Grid>

                <!-- Statistics -->
                <Grid Grid.Row="1"
                      Margin="0,32,12,8">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Total Parts -->
                    <Border Style="{DynamicResource ModernCardStyle}"
                            BorderBrush="{DynamicResource Border.Green.BordeBrush}">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{Binding PartsInCategory.Count, FallbackValue=10}"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource Indicator.Green.ForegroundBrush}"
                                       FontSize="32"
                                       FontFamily="{DynamicResource DynamicFontFamilyBold}" VerticalAlignment="Center"/>
                            <TextBlock Text="{DynamicResource TotalPartsStr}"
                                       HorizontalAlignment="Center"
                                       FontSize="{StaticResource FontSizeRegular}"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </Border>


                    <!-- SubCategories-->
                    <Border Style="{DynamicResource ModernCardStyle}"
                            Grid.Column="2"
                            BorderBrush="{DynamicResource Border.Blue.BordeBrush}">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{Binding Subcategories.Count, FallbackValue=10}"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource Indicator.Blue.ForegroundBrush}"
                                       FontSize="32"
                                       FontFamily="{DynamicResource DynamicFontFamilyBold}" />
                            <TextBlock Text="{DynamicResource SubcategoriesStr}"
                                       HorizontalAlignment="Center"
                                       FontSize="{StaticResource FontSizeRegular}" />
                        </StackPanel>
                    </Border>

                    <!-- Active Parts-->
                    <Border Style="{DynamicResource ModernCardStyle}"
                            Grid.Column="4"
                            BorderBrush="{DynamicResource Border.Orange.BordeBrush}">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{Binding ActivePartsCount, FallbackValue=15}"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource Indicator.Orange.ForegroundBrush}"
                                       FontSize="32"
                                       FontFamily="{DynamicResource DynamicFontFamilyBold}" />
                            <TextBlock Text="{DynamicResource ActivePartsStr}"
                                       HorizontalAlignment="Center"
                                       FontSize="{StaticResource FontSizeRegular}" />
                        </StackPanel>
                    </Border>

                    <!-- Low Stock Parts-->
                    <Border Style="{DynamicResource ModernCardStyle}"
                            Grid.Column="6"
                            BorderBrush="{DynamicResource Border.Red.BordeBrush}">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{Binding LowStockPartsCount, FallbackValue=2}"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource Indicator.Red.ForegroundBrush}"
                                       FontSize="32"
                                       FontFamily="{DynamicResource DynamicFontFamilyBold}" />
                            <TextBlock Text="{DynamicResource LowStockParts}"
                                       HorizontalAlignment="Center"
                                       FontSize="{StaticResource FontSizeRegular}" />
                        </StackPanel>
                    </Border>



                </Grid>

                <!-- Sub Categories -->
                <Grid Grid.Row="2" Margin="0,10,0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" MinHeight="100"/>
                    </Grid.RowDefinitions>

                    <!-- Title -->
                    <Grid Margin="0,0,14,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <wpfUi:SymbolIcon Symbol="Group24"
                                              FontSize="16"
                                              VerticalAlignment="Center" />
                            <TextBlock Text="{DynamicResource SubcategoriesStr}"
                                       FontSize="{DynamicResource FontSizeMedium}"
                                       VerticalAlignment="Center"
                                       FontFamily="{DynamicResource DynamicFontFamilyBold}"
                                       Margin="8,0,0,0" />
                        </StackPanel>

                        <!-- Add SubCategory Button-->
                        <xBtn:XButton Style="{DynamicResource RegularButtonStyle}" Grid.Column="1" Command="{Binding ShowAddSubCategoryDialogCommand}" IsLoading="{Binding IsAddingSubCategory}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{DynamicResource AddSubCategoryStr}"
                                           VerticalAlignment="Center" />
                                <wpfUi:SymbolIcon Symbol="Add48" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </xBtn:XButton>
                    </Grid>

                    <Separator Grid.Row="1" BorderBrush="{DynamicResource Seprator.BorderBrush}" Opacity="0.5" Margin="0,5,0,8"/>

                    <!-- Content -->
                    <Grid Grid.Row="2">
                        <Grid  Visibility="{Binding IsLoadingSubcategories, Converter={StaticResource BooleanToInverseVisibilityConverter}}">
                            <ItemsControl Grid.Row="1"
                                          ItemsSource="{Binding Subcategories}"
                                          Visibility="{Binding HasSubcategories, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type dtos:CategoryDto}">
                                        <Border x:Name="CardBorder"
                                                Width="280"
                                                Height="320"
                                                Margin="15,10"
                                                Background="{DynamicResource Card.BackgroundBrush}"
                                                BorderBrush="{DynamicResource Card.BorderBrush}"
                                                BorderThickness="0"
                                                CornerRadius="16"
                                                Cursor="Hand"
                                                SnapsToDevicePixels="True">

                                            <i:Interaction.Triggers>
                                                <i:EventTrigger EventName="MouseLeftButtonUp">
                                                    <i:InvokeCommandAction Command="{Binding DataContext.OpenSubCategoryDetailsCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                                           CommandParameter="{Binding}" />
                                                </i:EventTrigger>
                                            </i:Interaction.Triggers>
                                            <!-- Modern Card Shadow Effect -->
                                            <Border.Effect>
                                                <DropShadowEffect Color="Black"
                                                                  Direction="270"
                                                                  ShadowDepth="8"
                                                                  BlurRadius="20"
                                                                  Opacity="0.15" />
                                            </Border.Effect>

                                            <!-- Hover Animation Triggers -->
                                            <Border.Triggers>
                                                <EventTrigger RoutedEvent="MouseEnter">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                             Storyboard.TargetProperty="ScaleX"
                                                                             To="1.05"
                                                                             Duration="0:0:0.2">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseOut" />
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                            <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                             Storyboard.TargetProperty="ScaleY"
                                                                             To="1.05"
                                                                             Duration="0:0:0.2">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseOut" />
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                            <DoubleAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                             Storyboard.TargetProperty="Opacity"
                                                                             To="1"
                                                                             Duration="0:0:0.3" />
                                                            <ThicknessAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                                Storyboard.TargetProperty="Margin"
                                                                                To="0,0,12,12"
                                                                                Duration="0:0:0.3">
                                                                <ThicknessAnimation.EasingFunction>
                                                                    <BackEase EasingMode="EaseOut" />
                                                                </ThicknessAnimation.EasingFunction>
                                                            </ThicknessAnimation>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                                <EventTrigger RoutedEvent="MouseLeave">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                             Storyboard.TargetProperty="ScaleX"
                                                                             To="1"
                                                                             Duration="0:0:0.2">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseOut" />
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                            <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                             Storyboard.TargetProperty="ScaleY"
                                                                             To="1"
                                                                             Duration="0:0:0.2">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseOut" />
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                            <DoubleAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                             Storyboard.TargetProperty="Opacity"
                                                                             To="0"
                                                                             Duration="0:0:0.2" />
                                                            <ThicknessAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                                Storyboard.TargetProperty="Margin"
                                                                                To="0,0,12,32"
                                                                                Duration="0:0:0.2" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </Border.Triggers>

                                            <Border.RenderTransform>
                                                <ScaleTransform x:Name="ScaleTransform"
                                                                ScaleX="1"
                                                                ScaleY="1"
                                                                CenterX="140"
                                                                CenterY="160" />
                                            </Border.RenderTransform>

                                            <Grid ClipToBounds="True">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="180" />
                                                    <!-- Image Area -->
                                                    <RowDefinition Height="*" />
                                                    <!-- Content Area -->
                                                </Grid.RowDefinitions>

                                                <!-- Image Section with Gradient Overlay -->
                                                <Grid Grid.Row="0">
                                                    <Border CornerRadius="16,16,0,0"
                                                            ClipToBounds="True"
                                                            Background="{DynamicResource Card.Header.BackgroundBrush}">

                                                        <!-- Image with Rounded Corners -->
                                                        <Grid>
                                                            <Grid.Clip>
                                                                <RectangleGeometry Rect="0,0,280,200"
                                                                                   RadiusX="16"
                                                                                   RadiusY="12" />
                                                            </Grid.Clip>

                                                            <!-- Background Image -->
                                                            <Image Source="{Binding ImagePath, Converter={StaticResource StringToImageSourceConverter}}"
                                                                   Stretch="Fill"
                                                                   VerticalAlignment="Center"
                                                                   HorizontalAlignment="Center">
                                                                <Image.Clip>
                                                                    <RectangleGeometry Rect="0,0,280,200"
                                                                                       RadiusX="16"
                                                                                       RadiusY="12" />
                                                                </Image.Clip>
                                                                <!-- Fallback when no image -->
                                                                <Image.Style>
                                                                    <Style TargetType="Image">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding ImagePath}"
                                                                                         Value="{x:Null}">
                                                                                <Setter Property="Visibility"
                                                                                        Value="Collapsed" />
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding ImagePath}"
                                                                                         Value="">
                                                                                <Setter Property="Visibility"
                                                                                        Value="Collapsed" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Image.Style>
                                                            </Image>

                                                            <!-- Fallback Icon for categories without images -->
                                                            <Grid Visibility="{Binding ImagePath, Converter={StaticResource NullOrEmptyToVisibilityConverter}}">
                                                                <Rectangle Fill="{DynamicResource Card.Header.BackgroundBrush}"
                                                                           Opacity="0.1"
                                                                           RadiusX="16"
                                                                           RadiusY="16" />
                                                                <wpfUi:SymbolIcon Symbol="AppFolder48"
                                                                                  FontSize="48"
                                                                                  Foreground="{DynamicResource Text.SecondaryBrush}"
                                                                                  Opacity="0.6"
                                                                                  HorizontalAlignment="Center"
                                                                                  VerticalAlignment="Center" />
                                                            </Grid>

                                                            <!-- Gradient Overlay with Rounded Corners -->
                                                            <Rectangle RadiusX="0"
                                                                       RadiusY="16">
                                                                <Rectangle.Fill>
                                                                    <LinearGradientBrush StartPoint="0,0.7"
                                                                                         EndPoint="0,1">
                                                                        <GradientStop Color="Transparent"
                                                                                      Offset="0" />
                                                                        <GradientStop Color="#66000000"
                                                                                      Offset="1" />
                                                                    </LinearGradientBrush>
                                                                </Rectangle.Fill>
                                                            </Rectangle>
                                                        </Grid>
                                                    </Border>

                                                    <!-- Top-right indicators -->
                                                    <StackPanel Orientation="Horizontal"
                                                                HorizontalAlignment="Right"
                                                                VerticalAlignment="Top"
                                                                Margin="12,12,12,0">

                                                        <!-- Active Status Indicator -->
                                                        <Border Background="{Binding IsActive, Converter={StaticResource BooleanToStatusColorConverter}}"
                                                                CornerRadius="12"
                                                                Padding="8,4"
                                                                Margin="0,0,6,0">
                                                            <TextBlock Text="{Binding IsActive, Converter={StaticResource BooleanToStatusTextConverter}}"
                                                                       FontSize="10"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="White" />
                                                        </Border>

                                                        <!-- Subcategories Indicator -->
                                                        <Border Background="#FF4CAF50"
                                                                CornerRadius="12"
                                                                Padding="6,4"
                                                                Visibility="{Binding HasChildren, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <wpfUi:SymbolIcon Symbol="FolderOpenVertical16"
                                                                                  FontSize="10"
                                                                                  Foreground="White"
                                                                                  Margin="0,0,2,0" />
                                                                <TextBlock Text="SUB"
                                                                           FontSize="9"
                                                                           FontWeight="Bold"
                                                                           Foreground="White" />
                                                            </StackPanel>
                                                        </Border>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Content Section -->
                                                <Border Grid.Row="1"
                                                        Background="{DynamicResource Card.BackgroundBrush}"
                                                        CornerRadius="0,0,16,16"
                                                        Padding="16,12,16,16">

                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto" />
                                                            <!-- Title -->
                                                            <RowDefinition Height="Auto" />
                                                            <!-- Description -->
                                                            <RowDefinition Height="*" />
                                                            <!-- Stats -->
                                                            <RowDefinition Height="Auto" />
                                                            <!-- Parent Category -->
                                                        </Grid.RowDefinitions>

                                                        <!-- Category Name -->
                                                        <TextBlock Grid.Row="0"
                                                                   Text="{Binding Name}"
                                                                   FontWeight="Bold"
                                                                   FontSize="16"
                                                                   Foreground="{DynamicResource Text.PrimaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   MaxHeight="44"
                                                                   LineHeight="22" />

                                                        <!-- Description -->
                                                        <TextBlock Grid.Row="1"
                                                                   Text="{Binding Description}"
                                                                   FontSize="12"
                                                                   Foreground="{DynamicResource Text.SecondaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   MaxHeight="32"
                                                                   LineHeight="16"
                                                                   Margin="0,6,0,0"
                                                                   Opacity="0.8">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Description}"
                                                                                     Value="{x:Null}">
                                                                            <Setter Property="Visibility"
                                                                                    Value="Collapsed" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Description}"
                                                                                     Value="">
                                                                            <Setter Property="Visibility"
                                                                                    Value="Collapsed" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>

                                                        <!-- Statistics Area -->
                                                        <StackPanel Grid.Row="2"
                                                                    Orientation="Horizontal"
                                                                    VerticalAlignment="Center"
                                                                    Margin="0,8,0,0">

                                                            <!-- Parts Count with Icon -->
                                                            <Border Background="{DynamicResource Clinical.Appointment.AvailableBrush}"
                                                                    CornerRadius="8"
                                                                    Padding="8,4">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <wpfUi:SymbolIcon Symbol="Box20"
                                                                                      FontSize="14"
                                                                                      Foreground="{DynamicResource Text.SuccessBrush}"
                                                                                      VerticalAlignment="Center"
                                                                                      Margin="0,0,4,0" />
                                                                    <TextBlock FontSize="12"
                                                                               FontWeight="SemiBold"
                                                                               Foreground="{DynamicResource Text.SuccessBrush}"
                                                                               VerticalAlignment="Center">
                                            <Run Text="{Binding PartCount}" />
                                            <Run Text="Parts" />
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </Border>
                                                        </StackPanel>

                                                        <!-- Parent Category (if exists) -->
                                                        <TextBlock Grid.Row="3"
                                                                   FontSize="10"
                                                                   Foreground="{DynamicResource Text.SecondaryBrush}"
                                                                   Margin="0,6,0,0"
                                                                   Visibility="{Binding ParentCategoryName, Converter={StaticResource NullOrEmptyToInverseVisibilityConverter}}">
                                <Run Text="in" />
                                <Run Text="{Binding ParentCategoryName}"
                                                            FontWeight="SemiBold" />
                                                        </TextBlock>
                                                    </Grid>
                                                </Border>

                                                <!-- Floating Action Buttons -->
                                                <StackPanel x:Name="ActionButtonsPanel"
                                                            Orientation="Vertical"
                                                            HorizontalAlignment="Right"
                                                            VerticalAlignment="Bottom"
                                                            Margin="0,0,12,32"
                                                            Opacity="0">
                                                    <!-- Edit Button -->
                                                    <xBtn:XButton Style="{DynamicResource RegularButtonStyle}"
                                                                  ButtonType="Primary"
                                                                  Command="{Binding DataContext.ShowEditCategoryDialogCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                                  CommandParameter="{Binding}"
                                                                  ToolTip="{DynamicResource EditCategoryStr}"
                                                                  Cursor="Hand"
                                                                  Margin="0,0,0,8">
                                                        <xBtn:XButton.Effect>
                                                            <DropShadowEffect Color="Black"
                                                                              Direction="270"
                                                                              ShadowDepth="2"
                                                                              BlurRadius="8"
                                                                              Opacity="0.3" />
                                                        </xBtn:XButton.Effect>
                                                        <wpfUi:SymbolIcon Symbol="Edit20"
                                                                          FontSize="16"
                                                                          Foreground="White" />
                                                    </xBtn:XButton>

                                                    <!-- Delete Button -->
                                                    <xBtn:XButton Style="{DynamicResource RegularButtonStyle}"
                                                                  ButtonType="Danger"
                                                                  BorderThickness="0"
                                                                  Command="{Binding DataContext.ShowDeleteCategoryDialogCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                                  CommandParameter="{Binding}"
                                                                  ToolTip="{DynamicResource DeleteCategoryStr}"
                                                                  Cursor="Hand">
                                                        <xBtn:XButton.Effect>
                                                            <DropShadowEffect Color="Black"
                                                                              Direction="270"
                                                                              ShadowDepth="2"
                                                                              BlurRadius="8"
                                                                              Opacity="0.3" />
                                                        </xBtn:XButton.Effect>
                                                        <wpfUi:SymbolIcon Symbol="Delete20"
                                                                          FontSize="16"
                                                                          Foreground="White" />
                                                    </xBtn:XButton>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <TextBlock Text="{DynamicResource NoSubCategoriesFoundForThisCategoryStr}"
                                       Visibility="{Binding HasSubcategories, Converter={StaticResource BooleanToInverseVisibilityConverter}}"
                                       FontSize="16"
                                       Margin="15,10"
                                       Foreground="{DynamicResource Text.SecondaryBrush}" />
                        </Grid>

                        <!-- Loading Spinner -->
                        <spinner:DonutSpinner Width="80"
                                              Height="80"
                                              Visibility="{Binding IsLoadingSubcategories, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" />
                    </Grid>
                </Grid>
            </Grid>
        </ScrollViewer>
    </Border>
</UserControl>
