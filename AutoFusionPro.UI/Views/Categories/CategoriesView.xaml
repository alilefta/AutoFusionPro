<UserControl x:Class="AutoFusionPro.UI.Views.Categories.CategoriesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:AutoFusionPro.UI.Views.Categories"
             xmlns:vm="clr-namespace:AutoFusionPro.UI.ViewModels.Categories"
             xmlns:xBtn="clr-namespace:AutoFusionPro.UI.Controls.Buttons"
             xmlns:forms="clr-namespace:AutoFusionPro.UI.Controls.Forms"
             xmlns:spinner="clr-namespace:AutoFusionPro.UI.Controls.LoadingSpinners"
             xmlns:dtos="clr-namespace:AutoFusionPro.Application.DTOs.Category;assembly=AutoFusionPro.Application"
             xmlns:wpfUi="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:filterDto="clr-namespace:AutoFusionPro.UI.Helpers.Filtration"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:CategoriesViewModel}"
             d:DesignHeight="550"
             d:DesignWidth="1200"
             Background="{DynamicResource Window.BackgroundBrush}"
             FlowDirection="{Binding CurrentWorkFlow}"
             Foreground="{DynamicResource Text.PrimaryBrush}"
             FontFamily="{DynamicResource DynamicFontFamilyRegular}">
    <Border Padding="10,15,10,8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Content -->
            <Grid Margin="8,10,8,5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Search, Filters and Action Buttons -->
                <Grid Margin="8,0,8,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <forms:SearchTextBox SearchQuery="{Binding SearchQueryText, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="{DynamicResource SearchForCompatibleVehiclesStr}"
                                         ButtonCommand="{Binding ClearCategorySearchCommand}"
                                         IsClearButtonEnabled="{Binding HasTextCategorySearchQuery}"
                                         ButtonVisibility="{Binding HasTextCategorySearchQuery, Converter={StaticResource BooleanToVisibilityConverter}}"
                                         Height="40" />

                    <!-- Action Buttons -->
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="2"
                                Margin="50,0,0,0">

                        <xBtn:XButton ButtonType="Regular"
                                      Style="{DynamicResource RegularButtonStyle}"
                                      Command="{Binding ChangeViewCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{DynamicResource DynamicFontFamilyRegular}"
                                           VerticalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding DataContext.IsCardViewActive, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                             Value="False">
                                                    <Setter Property="Text"
                                                            Value="{DynamicResource ShowGridViewStr}" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding DataContext.IsCardViewActive, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                             Value="True">
                                                    <Setter Property="Text"
                                                            Value="{DynamicResource ShowListViewStr}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <wpfUi:SymbolIcon Symbol="{Binding ViewerIcon}"
                                                  Margin="5,0,0,0"
                                                  VerticalAlignment="Center">
                                </wpfUi:SymbolIcon>
                            </StackPanel>
                        </xBtn:XButton>

                        <xBtn:XButton ButtonType="Regular"
                                      Margin="8,0,0,0"
                                      Style="{DynamicResource RegularButtonStyle}"
                                      IsLoading="{Binding IsShowingFilters}"
                                      Command="{Binding ShowFilterOptionsDialogCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{DynamicResource FiltersStr}"
                                           VerticalAlignment="Center"
                                           FontSize="13" />
                                <wpfUi:SymbolIcon Symbol="Filter24"
                                                  Margin="5,0,0,0"
                                                  VerticalAlignment="Center"
                                                  FontSize="16" />

                                <!-- Filters Selected Indicator-->
                                <Ellipse Width="10"
                                         Height="10"
                                         Margin="15,0,0,0"
                                         Visibility="{Binding IsFiltersActive, Converter={StaticResource BooleanToVisibilityConverter}}"
                                         Fill="{DynamicResource Border.ErrorBrush}" />
                            </StackPanel>
                        </xBtn:XButton>

                        <xBtn:XButton ButtonType="Primary"
                                      IsLoading="{Binding IsAdding}"
                                      Margin="8,0,0,0"
                                      Command="{Binding ShowAddCategoryDialogCommand}"
                                      Style="{DynamicResource RegularButtonStyle}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{DynamicResource AddCategoryStr}"
                                           VerticalAlignment="Center"
                                           FontSize="13" />
                                <wpfUi:SymbolIcon Symbol="Add48"
                                                  Margin="5,0,0,0"
                                                  VerticalAlignment="Center"
                                                  FontSize="13" />

                            </StackPanel>
                        </xBtn:XButton>
                    </StackPanel>

                </Grid>

                <!-- Active Filters Bar-->
                <Border Grid.Row="1"
                        Margin="8,10,8,5"
                        Padding="8,5"
                        MinHeight="30"
                        Visibility="{Binding IsFiltersActive, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{DynamicResource ActiveFiltersStr}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"
                                   FontWeight="SemiBold" />
                        <ItemsControl ItemsSource="{Binding ActiveFiltersDisplayCollection}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type filterDto:ActiveFilterDisplayItem}">
                                    <Border Background="{DynamicResource ActiveFilter.BackgroundBrush}"
                                            CornerRadius="10"
                                            Padding="9,4"
                                            BorderBrush="{DynamicResource ActiveFilter.BorderBrush}"
                                            BorderThickness="0.6"
                                            Margin="3">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock VerticalAlignment="Center"
                                                       FontFamily="{DynamicResource DynamicFontFamilyRegular}"
                                                       Foreground="{DynamicResource ActiveFilter.ForegroundBrush}">
                                                    <Run Text="{Binding FilterType}"
                                                         FontWeight="SemiBold" />: <Run Text="{Binding FilterValueDisplay}" />
                                            </TextBlock>
                                            <Button Grid.Column="1"
                                                    Padding="2"
                                                    Width="16"
                                                    Height="16"
                                                    Margin="5,0,0,0"
                                                    VerticalAlignment="Center"
                                                    VerticalContentAlignment="Center"
                                                    HorizontalContentAlignment="Center"
                                                    Cursor="Hand"
                                                    Command="{Binding DataContext.RemoveActiveFilterCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="{DynamicResource RemoveThisFilterStr}">
                                                <wpfUi:SymbolIcon Symbol="Dismiss16"
                                                                  FontSize="10"
                                                                  Foreground="{DynamicResource ActiveFilter.ForegroundBrush}"
                                                                  FontFamily="{DynamicResource FluentSystemIconsFontRegular}"
                                                                  Margin="0"
                                                                  VerticalAlignment="Center" />
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Data Grid -->
                <Grid Grid.Row="2"
                      Margin="0,10,0,0">

                    <wpfUi:DataGrid ItemsSource="{Binding DisplayedCategories}"
                                    Visibility="{Binding IsCardViewActive, Converter={StaticResource BooleanToInverseVisibilityConverter}}"
                                    Grid.Row="2"
                                    Margin="0,8,0,0"
                                    SelectedItem="{Binding SelectedCategory}"
                                    Style="{DynamicResource ModernDataGridStyle}"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    IsReadOnly="True"
                                    CanUserDeleteRows="False"
                                    CanUserReorderColumns="True"
                                    CanUserResizeColumns="True"
                                    CanUserSortColumns="True"
                                    SelectionMode="Single"
                                    GridLinesVisibility="Horizontal"
                                    AlternationCount="2"
                                    AlternatingRowBackground="{DynamicResource DataGrid.AlternatingRow.BackgroundBrush}"
                                    HeadersVisibility="Column">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="{DynamicResource CategoryPhotoStr}"
                                                    Width="130">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Image Source="{Binding ImagePath, Converter={StaticResource StringToImageSourceConverter}}"
                                               Height="40"
                                               Width="80"
                                               Stretch="Uniform"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Left" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="{DynamicResource NameStr}"
                                                Binding="{Binding Name}"
                                                Width="120" />
                            <DataGridCheckBoxColumn Header="{DynamicResource StatusStr}"
                                                    Binding="{Binding IsActive}"
                                                    IsReadOnly="True"
                                                    ElementStyle="{StaticResource BlueCheckBoxStyle}"
                                                    Width="80">

                            </DataGridCheckBoxColumn>
                            <DataGridTemplateColumn Header="{DynamicResource SubcategoriesCountStr}"
                                                    Width="180">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Children.Count}">
                                            <TextBlock.Foreground>
                                                <MultiBinding Converter="{StaticResource TextWithSelectionForegroundConverter}">
                                                    <Binding Path="Children" />
                                                    <Binding Path="IsSelected"
                                                             RelativeSource="{RelativeSource AncestorType=DataGridRow}" />
                                                </MultiBinding>
                                            </TextBlock.Foreground>
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="{DynamicResource PartsCountStr}"
                                                    Width="140">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding PartCount}">
                                            <TextBlock.Foreground>
                                                <MultiBinding Converter="{StaticResource TextWithSelectionForegroundConverter}">
                                                    <Binding Path="PartCount" />
                                                    <Binding Path="IsSelected"
                                                             RelativeSource="{RelativeSource AncestorType=DataGridRow}" />
                                                </MultiBinding>
                                            </TextBlock.Foreground>
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="{DynamicResource ManageStr}"
                                                    Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">

                                            <!-- Details Button -->
                                            <xBtn:XButton Style="{DynamicResource RegularButtonStyle}"
                                                          ButtonType="Regular"
                                                          Command="{Binding DataContext.OpenCategoryDetailsCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                          CommandParameter="{Binding}"
                                                          ToolTip="{DynamicResource OpenCategoryDetailsStr}"
                                                          Cursor="Hand">
                                                <xBtn:XButton.Effect>
                                                    <DropShadowEffect Color="Black"
                                                                      Direction="270"
                                                                      ShadowDepth="1"
                                                                      BlurRadius="10"
                                                                      Opacity="0.2" />
                                                </xBtn:XButton.Effect>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{DynamicResource GoToDetailsStr}"
                                                               VerticalAlignment="Center" />
                                                    <wpfUi:SymbolIcon Symbol="Open48"
                                                                      Margin="5,0,0,0"
                                                                      VerticalAlignment="Center"
                                                                      FontSize="16" />
                                                </StackPanel>
                                            </xBtn:XButton>
                                            <xBtn:XButton Cursor="Hand"
                                                          Style="{DynamicResource RegularButtonStyle}"
                                                          ButtonType="Warning"
                                                          Command="{Binding DataContext.ShowEditCategoryDialogCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                          CommandParameter="{Binding}"
                                                          Opacity="0.8"
                                                          Margin="5,0,0,0"
                                                          VerticalAlignment="Center">
                                                <StackPanel Orientation="Horizontal"
                                                            VerticalAlignment="Center">
                                                    <wpfUi:SymbolIcon Symbol="Edit48"
                                                                      VerticalAlignment="Center" />
                                                </StackPanel>
                                            </xBtn:XButton>

                                            <xBtn:XButton Cursor="Hand"
                                                          Style="{DynamicResource RegularButtonStyle}"
                                                          Command="{Binding DataContext.ShowDeleteCategoryDialogCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                          CommandParameter="{Binding}"
                                                          ButtonType="Danger"
                                                          VerticalAlignment="Center"
                                                          Opacity="0.8"
                                                          Margin="5,0,0,0">
                                                <StackPanel Orientation="Horizontal"
                                                            VerticalAlignment="Center">
                                                    <wpfUi:SymbolIcon Symbol="Delete48"
                                                                      VerticalAlignment="Center" />
                                                </StackPanel>
                                            </xBtn:XButton>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </wpfUi:DataGrid>

                    <ItemsControl ItemsSource="{Binding DisplayedCategories}"
                                  Visibility="{Binding IsCardViewActive, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type dtos:CategoryDto}">
                                <Border x:Name="CardBorder"
                                        Width="280"
                                        Height="320"
                                        Margin="15,10"
                                        Background="{DynamicResource Card.BackgroundBrush}"
                                        BorderBrush="{DynamicResource Card.BorderBrush}"
                                        BorderThickness="0"
                                        CornerRadius="16"
                                        Cursor="Hand"
                                        SnapsToDevicePixels="True">

                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="MouseLeftButtonUp">
                                            <i:InvokeCommandAction Command="{Binding DataContext.OpenCategoryDetailsCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                                   CommandParameter="{Binding}" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>

                                    <!-- Modern Card Shadow Effect -->
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black"
                                                          Direction="270"
                                                          ShadowDepth="8"
                                                          BlurRadius="20"
                                                          Opacity="0.15" />
                                    </Border.Effect>

                                    <!-- Hover Animation Triggers -->
                                    <Border.Triggers>
                                        <EventTrigger RoutedEvent="MouseEnter">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                     Storyboard.TargetProperty="ScaleX"
                                                                     To="1.05"
                                                                     Duration="0:0:0.2">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut" />
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                    <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                     Storyboard.TargetProperty="ScaleY"
                                                                     To="1.05"
                                                                     Duration="0:0:0.2">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut" />
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                    <DoubleAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                     Storyboard.TargetProperty="Opacity"
                                                                     To="1"
                                                                     Duration="0:0:0.3" />
                                                    <ThicknessAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                        Storyboard.TargetProperty="Margin"
                                                                        To="0,0,12,12"
                                                                        Duration="0:0:0.3">
                                                        <ThicknessAnimation.EasingFunction>
                                                            <BackEase EasingMode="EaseOut" />
                                                        </ThicknessAnimation.EasingFunction>
                                                    </ThicknessAnimation>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="MouseLeave">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                     Storyboard.TargetProperty="ScaleX"
                                                                     To="1"
                                                                     Duration="0:0:0.2">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut" />
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                    <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                     Storyboard.TargetProperty="ScaleY"
                                                                     To="1"
                                                                     Duration="0:0:0.2">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut" />
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                    <DoubleAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                     Storyboard.TargetProperty="Opacity"
                                                                     To="0"
                                                                     Duration="0:0:0.2" />
                                                    <ThicknessAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                        Storyboard.TargetProperty="Margin"
                                                                        To="0,0,12,32"
                                                                        Duration="0:0:0.2" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Border.Triggers>

                                    <Border.RenderTransform>
                                        <ScaleTransform x:Name="ScaleTransform"
                                                        ScaleX="1"
                                                        ScaleY="1"
                                                        CenterX="140"
                                                        CenterY="160" />
                                    </Border.RenderTransform>
                                    <Grid ClipToBounds="True">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="180" />
                                            <!-- Image Area -->
                                            <RowDefinition Height="*" />
                                            <!-- Content Area -->
                                        </Grid.RowDefinitions>

                                        <!-- Image Section with Gradient Overlay -->
                                        <Grid Grid.Row="0">
                                            <Border CornerRadius="16,16,0,0"
                                                    ClipToBounds="True"
                                                    Background="{DynamicResource Card.Header.BackgroundBrush}">

                                                <!-- Image with Rounded Corners -->
                                                <Grid>
                                                    <Grid.Clip>
                                                        <RectangleGeometry Rect="0,0,280,200"
                                                                           RadiusX="16"
                                                                           RadiusY="12" />
                                                    </Grid.Clip>

                                                    <!-- Background Image -->
                                                    <Image Source="{Binding ImagePath, Converter={StaticResource StringToImageSourceConverter}}"
                                                           Stretch="Fill"
                                                           VerticalAlignment="Center"
                                                           HorizontalAlignment="Center">
                                                        <Image.Clip>
                                                            <RectangleGeometry Rect="0,0,280,200"
                                                                               RadiusX="16"
                                                                               RadiusY="12" />
                                                        </Image.Clip>
                                                        <!-- Fallback when no image -->
                                                        <Image.Style>
                                                            <Style TargetType="Image">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ImagePath}"
                                                                                 Value="{x:Null}">
                                                                        <Setter Property="Visibility"
                                                                                Value="Collapsed" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding ImagePath}"
                                                                                 Value="">
                                                                        <Setter Property="Visibility"
                                                                                Value="Collapsed" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Image.Style>
                                                    </Image>

                                                    <!-- Fallback Icon for categories without images -->
                                                    <Grid Visibility="{Binding ImagePath, Converter={StaticResource NullOrEmptyToVisibilityConverter}}">
                                                        <Rectangle Fill="{DynamicResource Card.Header.BackgroundBrush}"
                                                                   Opacity="0.1"
                                                                   RadiusX="16"
                                                                   RadiusY="16" />
                                                        <wpfUi:SymbolIcon Symbol="AppFolder48"
                                                                          FontSize="48"
                                                                          Foreground="{DynamicResource Text.SecondaryBrush}"
                                                                          Opacity="0.6"
                                                                          HorizontalAlignment="Center"
                                                                          VerticalAlignment="Center" />
                                                    </Grid>

                                                    <!-- Gradient Overlay with Rounded Corners -->
                                                    <Rectangle RadiusX="0"
                                                               RadiusY="16">
                                                        <Rectangle.Fill>
                                                            <LinearGradientBrush StartPoint="0,0.7"
                                                                                 EndPoint="0,1">
                                                                <GradientStop Color="Transparent"
                                                                              Offset="0" />
                                                                <GradientStop Color="#66000000"
                                                                              Offset="1" />
                                                            </LinearGradientBrush>
                                                        </Rectangle.Fill>
                                                    </Rectangle>
                                                </Grid>
                                            </Border>

                                            <!-- Top-right indicators -->
                                            <StackPanel Orientation="Horizontal"
                                                        HorizontalAlignment="Right"
                                                        VerticalAlignment="Top"
                                                        Margin="12,12,12,0">

                                                <!-- Active Status Indicator -->
                                                <Border Background="{Binding IsActive, Converter={StaticResource BooleanToStatusColorConverter}}"
                                                        CornerRadius="12"
                                                        Padding="8,4"
                                                        Margin="0,0,6,0">
                                                    <TextBlock Text="{Binding IsActive, Converter={StaticResource BooleanToStatusTextConverter}}"
                                                               FontSize="10"
                                                               FontWeight="SemiBold"
                                                               Foreground="White" />
                                                </Border>

                                                <!-- Subcategories Indicator -->
                                                <Border Background="#FF4CAF50"
                                                        CornerRadius="12"
                                                        Padding="6,4"
                                                        Visibility="{Binding HasChildren, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <wpfUi:SymbolIcon Symbol="FolderOpenVertical16"
                                                                          FontSize="10"
                                                                          Foreground="White"
                                                                          Margin="0,0,2,0" />
                                                        <TextBlock Text="SUB"
                                                                   FontSize="9"
                                                                   FontWeight="Bold"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Content Section -->
                                        <Border Grid.Row="1"
                                                Background="{DynamicResource Card.BackgroundBrush}"
                                                CornerRadius="0,0,16,16"
                                                Padding="16,12,16,16">

                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <!-- Title -->
                                                    <RowDefinition Height="Auto" />
                                                    <!-- Description -->
                                                    <RowDefinition Height="*" />
                                                    <!-- Stats -->
                                                    <RowDefinition Height="Auto" />
                                                    <!-- Parent Category -->
                                                </Grid.RowDefinitions>

                                                <!-- Category Name -->
                                                <TextBlock Grid.Row="0"
                                                           Text="{Binding Name}"
                                                           FontWeight="Bold"
                                                           FontSize="16"
                                                           Foreground="{DynamicResource Text.PrimaryBrush}"
                                                           TextWrapping="Wrap"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxHeight="44"
                                                           LineHeight="22" />

                                                <!-- Description -->
                                                <TextBlock Grid.Row="1"
                                                           Text="{Binding Description}"
                                                           FontSize="12"
                                                           Foreground="{DynamicResource Text.SecondaryBrush}"
                                                           TextWrapping="Wrap"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxHeight="32"
                                                           LineHeight="16"
                                                           Margin="0,6,0,0"
                                                           Opacity="0.8">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Description}"
                                                                             Value="{x:Null}">
                                                                    <Setter Property="Visibility"
                                                                            Value="Collapsed" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Description}"
                                                                             Value="">
                                                                    <Setter Property="Visibility"
                                                                            Value="Collapsed" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>

                                                <!-- Statistics Area -->
                                                <StackPanel Grid.Row="2"
                                                            Orientation="Horizontal"
                                                            VerticalAlignment="Center"
                                                            Margin="0,8,0,0">

                                                    <!-- Parts Count with Icon -->
                                                    <Border Background="{DynamicResource Clinical.Appointment.AvailableBrush}"
                                                            CornerRadius="8"
                                                            Padding="8,4">
                                                        <StackPanel Orientation="Horizontal">
                                                            <wpfUi:SymbolIcon Symbol="Box20"
                                                                              FontSize="14"
                                                                              Foreground="{DynamicResource Text.SuccessBrush}"
                                                                              VerticalAlignment="Center"
                                                                              Margin="0,0,4,0" />
                                                            <TextBlock FontSize="12"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{DynamicResource Text.SuccessBrush}"
                                                                       VerticalAlignment="Center">
                                            <Run Text="{Binding PartCount}" />
                                            <Run Text="Parts" />
                                                            </TextBlock>
                                                        </StackPanel>
                                                    </Border>
                                                </StackPanel>

                                                <!-- Parent Category (if exists) -->
                                                <TextBlock Grid.Row="3"
                                                           FontSize="10"
                                                           Foreground="{DynamicResource Text.SecondaryBrush}"
                                                           Margin="0,6,0,0"
                                                           Visibility="{Binding ParentCategoryName, Converter={StaticResource NullOrEmptyToInverseVisibilityConverter}}">
                                <Run Text="in" />
                                <Run Text="{Binding ParentCategoryName}"
                                                    FontWeight="SemiBold" />
                                                </TextBlock>
                                            </Grid>
                                        </Border>

                                        <!-- Floating Action Buttons -->
                                        <StackPanel x:Name="ActionButtonsPanel"
                                                    Orientation="Vertical"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Bottom"
                                                    Margin="0,0,12,32"
                                                    Opacity="0">
                                            <!-- Edit Button -->
                                            <xBtn:XButton Style="{DynamicResource RegularButtonStyle}"
                                                          ButtonType="Primary"
                                                          Command="{Binding DataContext.ShowEditCategoryDialogCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                                          CommandParameter="{Binding}"
                                                          ToolTip="{DynamicResource EditCategoryStr}"
                                                          Cursor="Hand"
                                                          Margin="0,0,0,8">
                                                <xBtn:XButton.Effect>
                                                    <DropShadowEffect Color="Black"
                                                                      Direction="270"
                                                                      ShadowDepth="2"
                                                                      BlurRadius="8"
                                                                      Opacity="0.3" />
                                                </xBtn:XButton.Effect>
                                                <wpfUi:SymbolIcon Symbol="Edit20"
                                                                  FontSize="16"
                                                                  Foreground="White" />
                                            </xBtn:XButton>

                                            <!-- Delete Button -->
                                            <xBtn:XButton Style="{DynamicResource RegularButtonStyle}"
                                                          ButtonType="Danger"
                                                          BorderThickness="0"
                                                          Command="{Binding DataContext.ShowDeleteCategoryDialogCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                                          CommandParameter="{Binding}"
                                                          ToolTip="{DynamicResource DeleteCategoryStr}"
                                                          Cursor="Hand">
                                                <xBtn:XButton.Effect>
                                                    <DropShadowEffect Color="Black"
                                                                      Direction="270"
                                                                      ShadowDepth="2"
                                                                      BlurRadius="8"
                                                                      Opacity="0.3" />
                                                </xBtn:XButton.Effect>
                                                <wpfUi:SymbolIcon Symbol="Delete20"
                                                                  FontSize="16"
                                                                  Foreground="White" />
                                            </xBtn:XButton>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <spinner:DonutSpinner Width="200"
                                          Height="200"
                                          Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" />
                </Grid>


            </Grid>

            <!-- Status Bar -->
            <StatusBar Grid.Row="1">
                <StatusBarItem>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{DynamicResource TotalItemsStr}"
                                   FontFamily="{DynamicResource DynamicFontFamilyRegular}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{Binding DisplayedCategories.Count}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"
                                   FontFamily="{DynamicResource DynamicFontFamilyRegular}" />
                    </StackPanel>
                </StatusBarItem>
                <Separator />
                <StatusBarItem>
                    <ProgressBar Width="100"
                                 Height="15"
                                 IsIndeterminate="{Binding IsLoading}"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </StatusBarItem>
            </StatusBar>
        </Grid>

    </Border>
</UserControl>